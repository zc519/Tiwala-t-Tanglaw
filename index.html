<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tiwala't Tanglaw — UI Prototype</title>
  <meta name="description" content="Responsive prototype (HTML/CSS/JS) of Tiwala't Tanglaw based on provided UI/UX flow." />
  <style>
    /* ===== Design tokens (from spec) ===== */
    :root{
      /* Colors */
      --bg:#F9F9F9;
      --patriotic-red:#D32F2F;
      --deep-blue:#0D47A1;
      --gold:#FDB913;
      --muted:#7A818A;
      --card:#FFFFFF;
      --danger:#C62828;
      --success:#2E7D32;

      /* Spacing */
      --s4:4px; --s8:8px; --s12:12px; --s16:16px; --s24:24px; --s32:32px;

      /* Typography */
      --font-system: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      --headline-size:1.4rem; /* ~24px on many devices */
      --subhead-size:1rem;
      --body-size:0.875rem;

      --card-radius:8px;
      --cta-radius:20px;
      --shadow: 0 2px 6px rgba(13,71,161,0.08);
    }

    /* ===== Base ===== */
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; font-family:var(--font-system); background:var(--bg); color:#101318; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      -webkit-tap-highlight-color: transparent;
    }
    a{color:var(--deep-blue); text-decoration:none}

    /* ===== Layout helpers ===== */
    .container{max-width:1160px;margin:0 auto;padding:0 var(--s16)}
    .card{background:var(--card); border-radius:var(--card-radius); box-shadow:var(--shadow);}
    .row{display:flex;gap:var(--s16)}
    .col{flex:1}
    .muted{color:var(--muted)}

    /* ===== Login screen ===== */
    .login-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:var(--s24)}
    .login-wrap{display:flex;max-width:1000px;width:100%;gap:0;align-items:stretch}
    .brand-panel{flex:0 0 280px;background:linear-gradient(180deg,var(--deep-blue),#063c86);color:white;padding:var(--s24);border-top-left-radius:12px;border-bottom-left-radius:12px}
    .brand-panel h1{margin:0;font-size:1.1rem}
    .brand-panel p{margin-top:12px;color:rgba(255,255,255,0.9)}
    .form-card{flex:1;padding:var(--s24)}

    .form-group{margin-bottom:var(--s12)}
    label{display:block;font-weight:600;margin-bottom:6px}
    input[type=text],input[type=password],select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ee;font-size:var(--body-size)}
    .small{font-size:0.85rem}

    .primary-btn{background:var(--patriotic-red);color:white;border:none;padding:10px 16px;border-radius:var(--cta-radius);cursor:pointer;font-weight:600}
    .secondary-btn{background:transparent;border:2px solid var(--patriotic-red);color:var(--patriotic-red);padding:8px 12px;border-radius:12px;cursor:pointer}

    .link-row{display:flex;justify-content:space-between;align-items:center;margin-top:8px}

    /* Inline error */
    .error{color:var(--danger);font-size:0.875rem;margin-top:6px}

    /* Top nav / app shell */
    .app-shell{min-height:100vh;display:flex;flex-direction:column}
    .top-nav{background:var(--deep-blue);color:white;padding:12px 16px;display:flex;align-items:center;gap:12px}
    .top-nav .logo{font-weight:700}
    .top-nav .search{flex:1}
    .top-nav input{width:100%;padding:8px;border-radius:8px;border:none}

    .main-row{display:flex;flex:1;gap:16px;padding:16px}
    .sidebar{width:260px;background:var(--card);border-radius:8px;padding:12px;box-shadow:var(--shadow)}
    .sidebar .nav-item{display:flex;gap:10px;padding:10px;border-radius:8px;align-items:center;cursor:pointer}
    .sidebar .nav-item:hover{background:#f2f6ff}

    .content{flex:1}
    .right-panel{width:360px}

    /* Dashboard widgets */
    .kpi-row{display:flex;gap:12px;margin-bottom:12px}
    .kpi{flex:1;padding:12px;border-radius:8px;background:linear-gradient(90deg,#fff,#fbfbff);border:1px solid #f0f3fb}
    .map-mock{height:360px;border-radius:8px;background:linear-gradient(135deg,#e8f0ff,#fff);display:flex;align-items:center;justify-content:center;color:var(--muted)}

    /* Project table */
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #eef2f6;text-align:left;font-size:0.9rem}
    .badge{display:inline-block;padding:6px 10px;border-radius:12px;font-weight:600}
    .badge.on-track{background:#e8f7ff;color:var(--deep-blue)}
    .badge.delayed{background:#fff6e6;color:var(--gold)}
    .badge.flagged{background:#fff0f0;color:var(--danger)}

    /* Project header */
    .project-header{display:flex;justify-content:space-between;gap:12px;align-items:center}
    .progress{height:12px;background:#f0f4f9;border-radius:6px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--gold),var(--deep-blue));}

    /* Modals */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center;padding:16px}
    .modal{background:var(--card);width:100%;max-width:720px;border-radius:12px;padding:18px}

    /* Mobile bottom nav */
    .bottom-nav{display:none;position:fixed;bottom:12px;left:50%;transform:translateX(-50%);background:var(--card);box-shadow:var(--shadow);border-radius:40px;padding:8px;gap:6px}
    .fab{position:fixed;right:16px;bottom:76px;background:var(--patriotic-red);color:white;width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 8px 20px rgba(211,47,47,0.2);}

    /* Responsive */
    @media (max-width:900px){
      body {
        padding-bottom: 80px; /* Space for bottom nav */
      }
      .app-shell {
        min-height: 100vh;
        flex-direction: column;
      }
      .top-nav {
        flex-wrap: wrap;
        gap: 8px;
        padding: 10px 8px;
        font-size: 1rem;
      }
      .top-nav .search {
        order: 3;
        width: 100%;
        margin-top: 8px;
      }
      .main-row {
        flex-direction: column;
        gap: 0;
        padding: 8px;
      }
      .sidebar {
        display: none !important;
      }
      .right-panel {
        display: none !important;
      }
      .content {
        width: 100%;
        min-width: 0;
        padding: 0;
      }
      .card {
        border-radius: 12px;
        box-shadow: var(--shadow);
        margin-bottom: 12px;
      }
      .kpi-row {
        flex-direction: column;
        gap: 8px;
      }
      .bottom-nav {
        display: flex !important;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100vw;
        max-width: 100vw;
        border-radius: 0;
        box-shadow: 0 -2px 12px rgba(13,71,161,0.10);
        background: var(--card);
        justify-content: space-around;
        align-items: center;
        padding: 8px 0;
        z-index: 100;
        gap: 0;
      }
      .bottom-nav button {
        flex: 1 1 0;
        margin: 0 2px;
        min-width: 0;
        font-size: 1.3rem;
        border-radius: 16px;
        padding: 10px 0;
        background: #fff;
        color: var(--deep-blue);
        border: none;
        box-shadow: none;
      }
      #fabMobile {
        background: var(--patriotic-red) !important;
        color: #fff !important;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        font-size: 1.7rem;
        margin: 0 8px;
        box-shadow: 0 2px 8px rgba(211,47,47,0.15);
        position: relative;
        top: -12px;
        z-index: 2;
      }
      .fab {
        display: none !important;
      }
      /* Hide scrollbars for tables on mobile */
      table {
        font-size: 0.95rem;
        overflow-x: auto;
        display: block;
        width: 100%;
      }
      th, td {
        padding: 8px;
      }
      /* Make modals full screen on mobile */
      .modal-backdrop {
        padding: 0;
        align-items: flex-start;
      }
      .modal {
        border-radius: 0;
        max-width: 100vw;
        min-height: 100vh;
        padding: 18px 8px;
      }
    }

    /* Small helper utilities */
    .tiny{font-size:0.8rem;color:var(--muted)}
    .center{text-align:center}

    /* Accessible focus */
    button:focus,input:focus,select:focus{outline:3px solid rgba(13,71,161,0.12);outline-offset:2px}

    /* Add below your existing CSS in <style> */
.logo-box {
  width: 90px;
  height: 90px;
  background: white;
  border-radius: 24px; /* Makes it a circular square (rounded rectangle) */
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 22px auto;
  box-shadow: 0 2px 12px rgba(0,0,0,0.10);
  overflow: hidden;
  transition: transform 0.2s;
}
.logo-box:hover {
  transform: scale(1.08);
}
.logo-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 18px; /* Slightly less than the box for a nice effect */
}

/* Make accessibility buttons white */
#highContrastBtn,
#largeTextBtn {
  background: #fff !important;
  color: var(--deep-blue) !important;
  border: 2px solid var(--deep-blue) !important;
}
#highContrastBtn:focus,
#largeTextBtn:focus {
  outline: 3px solid var(--deep-blue);
}
#notifBtn,
#logoutBtn {
  background: #fff !important;
  color: var(--deep-blue) !important;
  border: 2px solid var(--deep-blue) !important;
}
#notifBtn:focus,
#logoutBtn:focus {
  outline: 3px solid var(--deep-blue);
}

/* Make "Signed in as" text white in app shell */
.top-nav .tiny.muted {
  color: #fff !important;
}

  </style>
</head>
<body>

<!-- ========== LOGIN SCREEN ========== -->
<div id="screen-login" class="login-screen" role="main">
  <div class="login-wrap card" aria-labelledby="loginTitle">
    <div class="brand-panel">
      <div class="logo-box">
        <img src="tiwala't tanglaw.jpg" alt="Tiwala't Tanglaw Logo" class="logo-img">
      </div>
      <h1 id="loginTitle" style="margin:0;">Tiwala't Tanglaw</h1>
      <p class="tiny">Transparency for public works</p>
      <div style="margin-top:18px">
        <strong>Welcome</strong>
        <p class="tiny">Sign in with your government account or continue as guest</p>
      </div>
      <div style="margin-top:24px;font-size:0.9rem">
        <button class="secondary-btn" id="highContrastBtn" aria-pressed="false">High-contrast</button>
        <button class="secondary-btn" id="largeTextBtn" style="margin-left:8px" aria-pressed="false">Large text</button>
      </div>
    </div>

    <div class="form-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <div>
          <h2 style="margin:0">Sign in</h2>
          <p class="tiny muted">Use email/password or Government SSO</p>
        </div>
        <div class="tiny">Need help? <a href="#">Contact LGU admin</a></div>
      </div>

      <div id="loginForm">
        <div class="form-group">
          <label for="email">Email or username</label>
          <input id="email" type="text" placeholder="name@domain.gov.ph" aria-describedby="emailHelp" />
          <div id="emailError" class="error" style="display:none"></div>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div style="display:flex;gap:8px;align-items:center"><input id="password" type="password" aria-describedby="pwdHelp" /><button id="togglePwd" class="secondary-btn" style="height:40px">Show</button></div>
          <div id="pwdError" class="error" style="display:none"></div>
        </div>

        <div class="form-group">
          <label for="role">Role</label>
          <select id="role">
            <option value="">Select role (or use SSO)</option>
            <option value="citizen">Citizen</option>
            <option value="lgu">LGU Officer</option>
            <option value="auditor">Auditor</option>
            <option value="ngo">NGO</option>
            <option value="admin">Admin</option>
          </select>
        </div>

        <div style="display:flex;gap:12px;margin-top:12px">
          <button class="primary-btn" id="loginBtn" disabled>Login</button>
          <button class="secondary-btn" id="ssoBtn">Login with SSO / GovID</button>
          <div style="flex:1"></div>
        </div>

        <div class="link-row">
          <a href="#" id="forgot">Forgot password?</a>
          <a href="#" id="guest">Continue as guest / Report an issue</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ========== APP SHELL ========== -->
<div id="screen-app" class="app-shell" style="display:none">
  <header class="top-nav" role="navigation">
    <div style="display:flex;align-items:center;gap:10px;">
      <div class="logo-box" style="width:32px;height:32px;margin:0;">
        <img src="tiwala't tanglaw.jpg" alt="Tiwala't Tanglaw Logo" class="logo-img" style="width:100%;height:100%;border-radius:12px;">
      </div>
      <div class="logo">Tiwala't Tanglaw</div>
    </div>
    <div class="search"><input id="globalSearch" placeholder="Search projects, contractors, locations..." aria-label="Global search"/></div>
    <div><button id="notifBtn" class="secondary-btn">🔔 <span id="notifCount">0</span></button></div>
    <div style="display:flex;gap:8px;align-items:center">
      <div class="tiny muted">Signed in as <strong id="currentUser">—</strong></div>
      <div><img id="avatar" src="" alt="User avatar" style="width:36px;height:36px;border-radius:50%"/></div>
      <div><button id="logoutBtn" class="secondary-btn">Logout</button></div>
    </div>
  </header>

  <div class="main-row container">
    <aside class="sidebar" aria-label="Main navigation">
      <div class="nav-item" data-route="dashboard">🏠 <span>Dashboard</span></div>
      <div class="nav-item" data-route="projects">📁 <span>Projects / Procurement</span></div>
      <div class="nav-item" data-route="map">🗺️ <span>Map</span></div>
      <div class="nav-item" data-route="reports">📝 <span>Citizen Reports</span></div>
      <div class="nav-item" data-route="anomalies">⚠️ <span>Anomalies</span></div>
      <div class="nav-item" data-route="audit">🧾 <span>Audit Toolkit</span></div>
      <div class="nav-item" data-route="settings">⚙️ <span>Settings</span></div>
    </aside>

    <main class="content">
      <!-- Dashboard view -->
      <section id="view-dashboard">
        <div class="kpi-row">
          <div class="kpi card">
            <div class="tiny">Active Projects</div>
            <div style="font-size:1.4rem;font-weight:700" id="kpi-projects">0</div>
          </div>
          <div class="kpi card">
            <div class="tiny">% On-time</div>
            <div style="font-size:1.4rem;font-weight:700" id="kpi-ontime">0%</div>
          </div>
          <div class="kpi card">
            <div class="tiny">Amount spent</div>
            <div style="font-size:1.4rem;font-weight:700" id="kpi-spent">₱0</div>
          </div>
          <div class="kpi card">
            <div class="tiny">Flagged Anomalies</div>
            <div style="font-size:1.4rem;font-weight:700;color:var(--danger)" id="kpi-flagged">0</div>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <div class="map-mock card">Interactive map (mock). Pins clickable.</div>
            <div style="margin-top:12px" class="card" id="recentProjects">
              <div style="padding:12px;border-bottom:1px solid #eef2f6;display:flex;justify-content:space-between;align-items:center">
                <strong>Recent Projects</strong>
                <button class="secondary-btn" id="createProjectBtn">Create project</button>
              </div>
              <div style="padding:12px;overflow:auto;max-height:260px">
                <table id="projectsTable" aria-describedby="projectsHelp">
                  <thead><tr><th>Project ID</th><th>Title</th><th>Stage</th><th>Budget</th><th></th></tr></thead>
                  <tbody></tbody>
                </table>
                <div id="projectsHelp" class="tiny muted">Click a project to open details.</div>
              </div>
            </div>
          </div>

          <aside class="right-panel">
            <div class="card" style="padding:12px;margin-bottom:12px">
              <strong>Recent alerts</strong>
              <div id="alertsList" style="margin-top:8px"></div>
            </div>

            <div class="card" style="padding:12px">
              <strong>Quick actions</strong>
              <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
                <button class="primary-btn" id="uploadProgressBtn">Upload progress</button>
                <button class="secondary-btn" id="openProcBtn">Open procurement</button>
              </div>
            </div>
          </aside>
        </div>
      </section>

      <!-- Projects list view -->
      <section id="view-projects" style="display:none">
        <div class="card" style="padding:12px;margin-bottom:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>Procurement Tracker</strong>
            <div style="display:flex;gap:8px;align-items:center">
              <label class="tiny">View</label>
              <select id="projView">
                <option>Table</option>
                <option>Timeline</option>
                <option>Kanban</option>
              </select>
            </div>
          </div>

          <div style="margin-top:12px;overflow:auto;max-height:560px">
            <table id="procTable">
              <thead><tr><th>ID</th><th>Title</th><th>Stage</th><th>Awardee</th><th>Budget</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Map view -->
      <section id="view-map" style="display:none">
        <div class="card" style="padding:12px">
          <strong>Map</strong>
          <div class="map-mock" style="margin-top:12px">Map (mock)</div>
        </div>
      </section>

      <!-- Citizen reports -->
      <section id="view-reports" style="display:none">
        <div class="card" style="padding:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>Citizen Reports</strong>
            <button class="primary-btn" id="reportIssueBtn">Report an Issue</button>
          </div>

          <div style="margin-top:12px">
            <table id="reportsTable"><thead><tr><th>ID</th><th>Category</th><th>Location</th><th>Status</th></tr></thead><tbody></tbody></table>
          </div>
        </div>
      </section>

      <!-- Anomalies -->
      <section id="view-anomalies" style="display:none">
        <div class="card" style="padding:12px">
          <strong>Anomalies & Audit</strong>
          <div id="anomalyList" style="margin-top:12px"></div>
        </div>
      </section>

      <!-- Settings -->
      <section id="view-settings" style="display:none">
        <div class="card" style="padding:12px">
          <strong>Settings & Profile</strong>
          <div style="margin-top:12px">
            <label class="tiny">Full name</label>
            <input id="setName"/>
            <label class="tiny">Email</label>
            <input id="setEmail"/>
            <div style="margin-top:8px;display:flex;gap:8px"><button class="primary-btn" id="saveSettingsBtn">Save</button></div>
          </div>
        </div>
      </section>

    </main>

  </div>

  <button class="fab" id="fabReport" title="Report">＋</button>
  <nav class="bottom-nav" role="navigation" aria-label="Mobile nav">
    <button class="secondary-btn" data-route="dashboard">🏠</button>
    <button class="secondary-btn" data-route="map">🗺️</button>
    <button class="primary-btn" id="fabMobile">＋</button>
    <button class="secondary-btn" data-route="anomalies">🔔</button>
    <button class="secondary-btn" data-route="settings">⚙️</button>
  </nav>
</div>


<!-- ===== MODALS ===== -->
<!-- 2FA modal -->
<div id="modal-2fa" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true" aria-labelledby="twoFATitle">
  <div class="modal">
    <h3 id="twoFATitle">Two-factor authentication</h3>
    <p class="tiny muted">Enter the 6-digit code sent to your phone/email</p>
    <div style="display:flex;gap:8px;margin-top:12px">
      <input id="code1" maxlength="1" aria-label="Digit 1" style="width:44px;text-align:center;font-size:1.2rem" />
      <input id="code2" maxlength="1" aria-label="Digit 2" style="width:44px;text-align:center;font-size:1.2rem" />
      <input id="code3" maxlength="1" aria-label="Digit 3" style="width:44px;text-align:center;font-size:1.2rem" />
      <input id="code4" maxlength="1" aria-label="Digit 4" style="width:44px;text-align:center;font-size:1.2rem" />
      <input id="code5" maxlength="1" aria-label="Digit 5" style="width:44px;text-align:center;font-size:1.2rem" />
      <input id="code6" maxlength="1" aria-label="Digit 6" style="width:44px;text-align:center;font-size:1.2rem" />
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <div class="tiny">Code expires in <span id="codeTimer">02:00</span></div>
      <div style="display:flex;gap:8px"><button class="secondary-btn" id="resendBtn">Resend code</button><button class="primary-btn" id="verify2fa">Verify</button></div>
    </div>
    <div id="twoFaError" class="error" style="display:none;margin-top:8px"></div>
  </div>
</div>

<!-- Onboarding modal -->
<div id="modal-onboard" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true">
  <div class="modal">
    <h3>Welcome — Tell us about you</h3>
    <div style="margin-top:12px">
      <label class="tiny">Full name</label>
      <input id="onName"/>
      <label class="tiny">Organization</label>
      <input id="onOrg" placeholder="Start typing..." />
      <label class="tiny">Office / LGU</label>
      <input id="onLGU"/>
    </div>
    <div style="display:flex;justify-content:space-between;margin-top:12px">
      <button class="secondary-btn" id="skipOnboard">Skip tour</button>
      <button class="primary-btn" id="saveOnboard">Save & continue</button>
    </div>
  </div>
</div>

<!-- Report modal -->
<div id="modal-report" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true">
  <div class="modal">
    <h3>Report an issue</h3>
    <p class="tiny muted">Quick report for citizens (photo + category)</p>
    <label class="tiny">Category</label>
    <select id="repCategory"><option value="">Select</option><option value="delay">Delay</option><option value="corruption">Corruption</option><option value="safety">Safety</option><option value="other">Other</option></select>
    <label class="tiny">Photo (simulated)</label>
    <input id="repPhoto" type="file" accept="image/*" />
    <label class="tiny">Description</label>
    <textarea id="repDesc" rows="3" maxlength="300" placeholder="Short description (max 300 chars)"></textarea>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <div class="tiny muted">Attach location: <input type="checkbox" id="repLocate" checked/></div>
      <div style="display:flex;gap:8px"><button class="secondary-btn" id="cancelReport">Cancel</button><button class="primary-btn" id="submitReport">Submit</button></div>
    </div>
  </div>
</div>

<!-- Project details modal -->
<div id="modal-project" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true">
  <div class="modal">
    <div class="project-header">
      <div>
        <h3 id="projTitle">Project title</h3>
        <div class="tiny muted">ID: <span id="projId">—</span> • Agency: <span id="projAgency">—</span></div>
      </div>
      <div style="min-width:220px">
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:6px"><button class="primary-btn">Add progress</button><button class="secondary-btn">Export dossier</button></div>
        <div class="progress" aria-hidden><i id="projProgress" style="width:0%"></i></div>
      </div>
    </div>

    <div style="margin-top:12px">
      <div style="display:flex;gap:12px">
        <div style="flex:1">
          <h4>Overview</h4>
          <p id="projOverview" class="tiny muted">Summary & timeline</p>
        </div>
        <div style="width:320px">
          <h4>Financials</h4>
          <p class="tiny muted" id="projFin">Payments & receipts</p>
        </div>
      </div>
    </div>

    <div style="display:flex;justify-content:flex-end;margin-top:12px"><button class="secondary-btn" id="closeProject">Close</button></div>
  </div>
</div>


<script>
  /* ====== Small in-memory mock and UI wiring ====== */
  const loginBtn = document.getElementById('loginBtn');
  const email = document.getElementById('email');
  const password = document.getElementById('password');
  const role = document.getElementById('role');
  const togglePwd = document.getElementById('togglePwd');
  const ssoBtn = document.getElementById('ssoBtn');
  const guest = document.getElementById('guest');

  const appShell = document.getElementById('screen-app');
  const loginScreen = document.getElementById('screen-login');
  const currentUser = document.getElementById('currentUser');
  const avatar = document.getElementById('avatar');
  const logoutBtn = document.getElementById('logoutBtn');
  const notifCount = document.getElementById('notifCount');

  const modal2fa = document.getElementById('modal-2fa');
  const modalOnboard = document.getElementById('modal-onboard');
  const modalReport = document.getElementById('modal-report');
  const modalProject = document.getElementById('modal-project');

  const projectsTableBody = document.querySelector('#projectsTable tbody');
  const procTableBody = document.querySelector('#procTable tbody');
  const reportsTableBody = document.querySelector('#reportsTable tbody');
  const anomalyList = document.getElementById('anomalyList');
  const alertsList = document.getElementById('alertsList');

  const screens = {
    dashboard: document.getElementById('view-dashboard'),
    projects: document.getElementById('view-projects'),
    map: document.getElementById('view-map'),
    reports: document.getElementById('view-reports'),
    anomalies: document.getElementById('view-anomalies'),
    settings: document.getElementById('view-settings')
  };

  // Simple mock data
  const mockProjects = [
    {id:'TTT-2025-0001',title:'Barangay Road Rehab',stage:'Construction',awardee:'Acme BuildCo',budget:12000000,progress:68,flag:'on-track'},
    {id:'TTT-2025-0002',title:'Waterworks Expansion',stage:'Procurement',awardee:'—',budget:8000000,progress:4,flag:'delayed'},
    {id:'TTT-2025-0003',title:'School Repair',stage:'Completed',awardee:'BuildIt',budget:2500000,progress:100,flag:'flagged'}
  ];

  const mockReports = [
    {id:'R-0001',cat:'Delay',loc:'Barangay San Isidro',status:'Open'},
    {id:'R-0002',cat:'Safety',loc:'Sitio Malaya',status:'In Progress'}
  ];

  const mockAnomalies = [
    {id:'A-001',score:92,reason:'Price anomaly: 35% above median',projects:['TTT-2025-0003']},
    {id:'A-002',score:66,reason:'Repeated contractor',projects:['TTT-2025-0001']}
  ];

  // Populate tables
  function renderProjects(){
    projectsTableBody.innerHTML=''; procTableBody.innerHTML='';
    mockProjects.forEach(p=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${p.id}</td><td>${p.title}</td><td>${p.stage}</td><td>₱${(p.budget).toLocaleString()}</td><td><button class='secondary-btn viewProj' data-id='${p.id}'>View</button></td>`;
      projectsTableBody.appendChild(tr);

      const tr2=document.createElement('tr');
      tr2.innerHTML=`<td>${p.id}</td><td>${p.title}</td><td>${p.stage}</td><td>${p.awardee}</td><td>₱${(p.budget).toLocaleString()}</td><td><button class='secondary-btn viewProj' data-id='${p.id}'>View</button></td>`;
      procTableBody.appendChild(tr2);
    });
  }

  function renderReports(){
    reportsTableBody.innerHTML='';
    mockReports.forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.id}</td><td>${r.cat}</td><td>${r.loc}</td><td>${r.status}</td>`;
      reportsTableBody.appendChild(tr);
    });
  }

  function renderAnomalies(){
    anomalyList.innerHTML=''; alertsList.innerHTML='';
    mockAnomalies.forEach(a=>{
      const div=document.createElement('div');
      div.className='card'; div.style.padding='8px'; div.style.marginBottom='8px';
      div.innerHTML=`<div style='display:flex;justify-content:space-between;align-items:center'><div><strong>Score ${a.score}</strong><div class='tiny muted'>${a.reason}</div></div><div><button class='secondary-btn'>Acknowledge</button></div></div>`;
      anomalyList.appendChild(div);

      const alert=document.createElement('div'); alert.className='tiny muted'; alert.textContent=`${a.id}: ${a.reason}`; alertsList.appendChild(alert);
    });
  }

  renderProjects(); renderReports(); renderAnomalies();

  // Basic KPI fill
  document.getElementById('kpi-projects').textContent = mockProjects.length;
  document.getElementById('kpi-ontime').textContent = '82%';
  document.getElementById('kpi-spent').textContent = '₱' + (14000000).toLocaleString();
  document.getElementById('kpi-flagged').textContent = mockAnomalies.length;

  // Toggle password visibility
  togglePwd.addEventListener('click', ()=>{
    if(password.type==='password'){password.type='text';togglePwd.textContent='Hide';}else{password.type='password';togglePwd.textContent='Show'}
  });

  // Simple validation
  function validateLogin(){
    const ok = email.value.trim().length>3 && password.value.trim().length>0;
    loginBtn.disabled = !ok;
  }
  email.addEventListener('input',validateLogin); password.addEventListener('input',validateLogin);

  // Simulate SSO
  ssoBtn.addEventListener('click', ()=>{
    // show redirect modal briefly (here: 800ms) then open 2FA for higher roles
    ssoBtn.textContent='Redirecting…'; setTimeout(()=>{ssoBtn.textContent='Login with SSO / GovID'; // assume LGU officer for demo
      role.value='lgu'; startLogin({name:'Juan Dela Cruz',role:'lgu'});
    },800);
  });

  // Guest
  guest.addEventListener('click', (e)=>{e.preventDefault(); startLogin({name:'Guest Citizen',role:'citizen',guest:true});});

  // Login click
  loginBtn.addEventListener('click', ()=>{
    // fake auth check
    if(password.value.length<4){document.getElementById('pwdError').style.display='block';document.getElementById('pwdError').textContent='Password required (min 4 chars)';return}
    if(!email.value.includes('@')){document.getElementById('emailError').style.display='block';document.getElementById('emailError').textContent='Invalid email format';return}
    document.getElementById('emailError').style.display='none';document.getElementById('pwdError').style.display='none';
    startLogin({name:email.value,role:role.value||'citizen'});
  });

  function startLogin(user){
    // If role requires 2FA
    const needs2fa = ['lgu','auditor','admin'].includes(user.role);
    if(needs2fa){open2FA(user);}else{completeLogin(user)}
  }

  function open2FA(user){
    modal2fa.style.display='flex';
    // start 2min timer
    let time=120; const timerEl=document.getElementById('codeTimer');
    const int=setInterval(()=>{time--; const mm=Math.floor(time/60).toString().padStart(2,'0'); const ss=(time%60).toString().padStart(2,'0'); timerEl.textContent=mm+':'+ss; if(time<=0){clearInterval(int);document.getElementById('twoFaError').style.display='block';document.getElementById('twoFaError').textContent='Code expired — resend'}},1000);

    document.getElementById('verify2fa').onclick = ()=>{
      // simple accept when code boxes filled with 111111
      const code = Array.from([1,2,3,4,5,6]).map(i=>document.getElementById('code'+i).value||'').join('');
      if(code==='111111'){modal2fa.style.display='none';completeLogin(user);clearInterval(int);}else{document.getElementById('twoFaError').style.display='block';document.getElementById('twoFaError').textContent='Incorrect code'}
    }
  }

  function completeLogin(user){
    loginScreen.style.display='none'; appShell.style.display='block';
    currentUser.textContent = user.name||'User'; avatar.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"><rect width="100%" height="100%" fill="%230D47A1"/><text x="50%" y="55%" font-size="28" text-anchor="middle" fill="white">'+(user.name?user.name.charAt(0).toUpperCase():'U')+'</text></svg>';

    // open onboarding for first-time non-guest
    if(!user.guest) setTimeout(()=>{modalOnboard.style.display='flex'},400);
  }

  // Simple nav
  document.querySelectorAll('.sidebar .nav-item').forEach(n=>n.addEventListener('click',()=>{
    const route = n.dataset.route; for(const s in screens){screens[s].style.display='none'}; screens[route].style.display='block';
  }));

  // Project view open
  document.addEventListener('click', (e)=>{
    if(e.target.classList.contains('viewProj')){
      const id = e.target.dataset.id; openProject(id);
    }
  });

  function openProject(id){
    const p = mockProjects.find(x=>x.id===id); if(!p) return;
    document.getElementById('projTitle').textContent = p.title; document.getElementById('projId').textContent = p.id; document.getElementById('projAgency').textContent = 'LGU Example';
    document.getElementById('projProgress').style.width = p.progress+'%'; document.getElementById('projOverview').textContent = p.stage + ' • ' + p.title;
    document.getElementById('projFin').textContent = 'Budget: ₱' + p.budget.toLocaleString();
    modalProject.style.display='flex';
  }

  document.getElementById('closeProject').addEventListener('click', ()=>{modalProject.style.display='none'});

  logoutBtn.addEventListener('click', ()=>{
    // check unsaved actions (very simple here)
    if(confirm('Logout now?')){appShell.style.display='none';loginScreen.style.display='block';}
  });

  // Onboarding
  document.getElementById('skipOnboard').addEventListener('click', ()=>{modalOnboard.style.display='none'});
  document.getElementById('saveOnboard').addEventListener('click', ()=>{modalOnboard.style.display='none'});

  // Report modal
  document.getElementById('reportIssueBtn').addEventListener('click', ()=>{modalReport.style.display='flex'});
  document.getElementById('fabReport').addEventListener('click', ()=>{modalReport.style.display='flex'});
  document.getElementById('cancelReport').addEventListener('click', ()=>{modalReport.style.display='none'});
  document.getElementById('submitReport').addEventListener('click', ()=>{
    const cat = document.getElementById('repCategory').value; const photo = document.getElementById('repPhoto').files.length>0; const desc = document.getElementById('repDesc').value.trim();
    if(!cat || !photo){alert('Please select a category and attach a photo (simulated)');return}
    const id = 'R-'+String(Math.floor(Math.random()*9000)+1000);
    mockReports.unshift({id,cat:cat,loc:'User location',status:'Open'});
    renderReports(); modalReport.style.display='none'; alert('Thanks! Your report ID '+id+' — We will review within 3 business days.');
  });

  // Create project button (demo)
  document.getElementById('createProjectBtn').addEventListener('click', ()=>{
    const id = 'TTT-2025-'+String(Math.floor(Math.random()*9000)+1000);
    mockProjects.unshift({id,title:'New project '+id,stage:'Planning',awardee:'—',budget:500000,progress:0,flag:'on-track'});
    renderProjects(); alert('Project created: '+id);
  });

  // Notifications demo
  let notif = 2; notifCount.textContent = notif;

  // Accessibility toggles
  document.getElementById('highContrastBtn').addEventListener('click', ()=>{
    const el = document.documentElement; const on = el.getAttribute('data-high-contrast')==='true'; el.setAttribute('data-high-contrast', String(!on));
    if(!on){document.body.style.background='#111';document.body.style.color='#fff';}else{document.body.style.background='var(--bg)';document.body.style.color='#101318'}
  });
  document.getElementById('largeTextBtn').addEventListener('click', ()=>{
    const el = document.documentElement; const on = el.getAttribute('data-large-text')==='true'; el.setAttribute('data-large-text', String(!on));
    if(!on){document.documentElement.style.setProperty('--headline-size','1.6rem');document.documentElement.style.setProperty('--body-size','1rem')}else{document.documentElement.style.setProperty('--headline-size','1.4rem');document.documentElement.style.setProperty('--body-size','0.875rem')}
  });

  // Close modals when clicking backdrop
  document.querySelectorAll('.modal-backdrop').forEach(m=>m.addEventListener('click',(e)=>{if(e.target===m){m.style.display='none'}}));

  // Keyboard-friendly 2FA inputs: auto-advance
  for(let i=1;i<=6;i++){ const el=document.getElementById('code'+i); el.addEventListener('input', (e)=>{ if(el.value.length>=1 && i<6) document.getElementById('code'+(i+1)).focus(); }); }

  // Wire up view switch for mobile nav
  document.querySelector('.bottom-nav').addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON' && e.target.hasAttribute('data-route')) {
      const route = e.target.getAttribute('data-route');
      for (const s in screens) {
        screens[s].style.display = 'none';
      }
      if (screens[route]) {
        screens[route].style.display = 'block';
      }
    }
    // Optionally handle the fabMobile button (report modal)
    if (e.target.id === 'fabMobile') {
      document.getElementById('modal-report').style.display = 'flex';
    }
  });

  // Basic accessibility: focus login email on load
  email.focus();

</script>

</body>
</html>
